{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="container">
    <div class="sidebar">
        <div class="admin-badge">üë®‚Äçüíº ADMIN</div>
        <div class="user-info">
            <strong>{{ username }}</strong>
        </div>
        <a href="{{ url_for('logout') }}"><button class="logout-btn">Logout</button></a>
    </div>
    
    <div class="main-content">
        <div class="header">
            <span class="logo">üë®‚Äçüíº</span>
            <h1>Admin Dashboard</h1>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('reservations')">All Reservations</button>
            <button class="tab" onclick="switchTab('rooms')">Room Status</button>
            <button class="tab" onclick="switchTab('payments')">Payment Logs</button>
        </div>
        
        <!-- RESERVATIONS TAB -->
        <div id="reservations" class="tab-content active">
            <h2>All Reservations</h2>
            <table class="table">
                <thead>
                    <tr>
                        <th>Res ID</th>
                        <th>Guest Name</th>
                        <th>Email</th>
                        <th>Check-In</th>
                        <th>Check-Out</th>
                        <th>Room</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% if reservations %}
                        {% for res in reservations %}
                        <tr>
                            <td>{{ res.reservation_id }}</td>
                            <td>{{ res.g_name }}</td>
                            <td>{{ res.g_email }}</td>
                            <td>{{ res.check_in_date }}</td>
                            <td>{{ res.check_out_date }}</td>
                            <td>{{ res.r_number or 'N/A' }}</td>
                            <td>
                                <span class="status-badge {% if res.reservation_status == 'Booked' %}status-booked{% elif res.reservation_status == 'Cancelled' %}status-cancelled{% endif %}">
                                    {% if res.reservation_status == 'Booked' %}
                                        üü¢ {{ res.reservation_status }}
                                    {% else %}
                                        üî¥ {{ res.reservation_status }}
                                    {% endif %}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">No reservations found</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
            {% if reservations %}
            <div class="info-box">Total Reservations: {{ reservations|length }}</div>
            {% endif %}
        </div>
        
        <!-- ROOMS TAB -->
        <div id="rooms" class="tab-content">
            <h2>Room Status</h2>
            <table class="table">
                <thead>
                    <tr>
                        <th>Room Number</th>
                        <th>Type</th>
                        <th>Price (‚Çπ)</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% if rooms %}
                        {% for room in rooms %}
                        <tr>
                            <td>{{ room.r_number }}</td>
                            <td>{{ room.room_name }}</td>
                            <td>{{ room.r_price }}</td>
                            <td>
                                <span class="status-badge {% if room.r_status == 'Available' %}status-available{% else %}status-booked{% endif %}">
                                    {% if room.r_status == 'Available' %}
                                        üü¢ {{ room.r_status }}
                                    {% else %}
                                        üî¥ {{ room.r_status }}
                                    {% endif %}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 20px;">No rooms found</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
            
            <!-- Room Statistics -->
            {% if rooms %}
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
                <div class="card">
                    <strong style="color: #58a6ff;">Total Rooms</strong>
                    <h3 style="font-size: 2em; color: #58a6ff; margin-top: 10px;">{{ rooms|length }}</h3>
                </div>
                <div class="card">
                    <strong style="color: #238636;">Available</strong>
                    <h3 style="font-size: 2em; color: #238636; margin-top: 10px;">
                        {% set available = rooms|selectattr('r_status', 'equalto', 'Available')|list|length %}
                        {{ available }}
                    </h3>
                </div>
                <div class="card">
                    <strong style="color: #da3633;">Booked</strong>
                    <h3 style="font-size: 2em; color: #da3633; margin-top: 10px;">
                        {% set booked = rooms|selectattr('r_status', 'equalto', 'Booked')|list|length %}
                        {{ booked }}
                    </h3>
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- PAYMENTS TAB -->
        <div id="payments" class="tab-content">
            <h2>Payment Logs</h2>
            <table class="table">
                <thead>
                    <tr>
                        <th>Log ID</th>
                        <th>Payment ID</th>
                        <th>Guest Name</th>
                        <th>Room</th>
                        <th>Message</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody>
                    {% if payment_logs %}
                        {% for log in payment_logs %}
                        <tr>
                            <td>{{ log.log_id }}</td>
                            <td>{{ log.payment_id }}</td>
                            <td>{{ log.guest_name or 'N/A' }}</td>
                            <td>{{ log.room_number }}</td>
                            <td>{{ log.log_message }}</td>
                            <td>{{ log.log_time }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px;">No payment logs found</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
            {% if payment_logs %}
            <div class="info-box">Total Payment Logs: {{ payment_logs|length }}</div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    function switchTab(tab) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
        
        document.getElementById(tab).classList.add('active');
        event.target.classList.add('active');
    }
</script>
{% endblock %}